<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: auto; padding: 20px; border-radius: 10px; background: #f5f5f5; display: none; }
        h2 { color: #333; }
        .profile-info { margin-top: 15px; text-align: left; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader-wrapper {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #007bff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
       window.Telegram.WebApp.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º Web App

        let tg = window.Telegram.WebApp;
        let user = tg.initDataUnsafe?.user;

        if (user) {
            document.getElementById("profile").innerHTML = `
                <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
                <p><b>ID:</b> ${user.id}</p>
                <p><b>–ù–∏–∫:</b> ${user.first_name} ${user.last_name || ""}</p>
                ${user.username ? `<p><b>–Æ–∑–µ—Ä:</b> @${user.username}</p>` : ""}
            `;

            // üìå –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch("/auth", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ initData: tg.initData })
            })
            .then(response => response.json())
            .then(data => console.log("–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data))
            .catch(error => console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error));
        } else {
            document.getElementById("profile").innerHTML = "<p>–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.</p>";
        }
        
        function isTelegramWebApp() {
            return navigator.userAgent.includes("Telegram") || window.Telegram !== undefined;
        }

        function redirectToTelegram() {
            const botUsername = "Petition_jp_Bot"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ username –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
            window.location.href = `https://t.me/${botUsername}?start=openonlytelegram`;
        }

        window.onload = function() {
            setTimeout(() => { // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ 1.5 —Å–µ–∫—É–Ω–¥—ã
                document.querySelector(".loader-wrapper").style.display = "none";

                if (!isTelegramWebApp()) {
                    redirectToTelegram();
                } else {
                    document.querySelector(".container").style.display = "block";
                    const urlParams = new URLSearchParams(window.location.search);
                    const userId = urlParams.get('id');
                    if (userId) {
                        document.getElementById("profile").innerHTML = `<p><strong>ID:</strong> ${userId}</p>`;
                    } else {
                        document.getElementById("profile").innerHTML = "<p>–û—à–∏–±–∫–∞: ID –Ω–µ –Ω–∞–π–¥–µ–Ω</p>";
                    }
                }
            }, 1500);
        };
    </script>
</head>
<body>

    <!-- –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loader-wrapper">
        <div class="loader"></div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–æ—Ñ–∏–ª–µ–º (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
    <div class="container">
        <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="profile-info" id="profile"></div>
    </div>

</body>
</html>
